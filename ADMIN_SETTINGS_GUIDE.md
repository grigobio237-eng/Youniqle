# 관리자 설정 가이드 및 개발 진행 내역

## 📋 목차
1. [관리자 설정 페이지 개요](#관리자-설정-페이지-개요)
2. [설정 카테고리별 상세 가이드](#설정-카테고리별-상세-가이드)
3. [이번 채팅 진행 내역](#이번-채팅-진행-내역)
4. [기술적 구현 사항](#기술적-구현-사항)
5. [사용법 및 주의사항](#사용법-및-주의사항)

---

## 🎯 관리자 설정 페이지 개요

### 접근 방법
- **URL**: `/admin/settings`
- **권한**: 관리자 권한 필요 (`admin@youniqle.com`, `grigobio237@gmail.com`)
- **네비게이션**: 관리자 패널 좌측 메뉴 → "설정" → "시스템 설정"

### 주요 기능
- ✅ 8개 카테고리로 체계적 분류
- ✅ 실시간 설정 저장
- ✅ 설정 초기화 기능
- ✅ 반응형 모바일 최적화
- ✅ 비밀번호 필드 보안 처리

---

## ⚙️ 설정 카테고리별 상세 가이드

### 1. 일반 설정 (General Settings)

#### 📝 사이트 기본 정보
- **사이트 이름**: 브랜드명 설정 (예: "Youniqle")
- **사이트 설명**: 메타 설명 및 소개 문구
- **기본 언어**: 다국어 지원 언어 선택
  - 한국어 (ko) - 기본값
  - 영어 (en)
  - 중국어 (zh)

#### 🌍 지역 및 통화 설정
- **시간대**: 서버 시간대 설정 (기본: Asia/Seoul)
- **날짜 형식**: YYYY-MM-DD 형식
- **통화**: KRW, USD, EUR 중 선택
- **통화 기호**: ₩, $, € 등

#### 🔧 시스템 모드
- **유지보수 모드**: 사이트 점검 시 활성화
- **유지보수 메시지**: 점검 중 표시 메시지

**💡 사용 팁**: 유지보수 모드 활성화 시 일반 사용자 접근이 차단됩니다.

---

### 2. 보안 설정 (Security Settings)

#### 🔐 인증 및 세션 관리
- **2단계 인증**: 추가 보안 계층 활성화
- **세션 타임아웃**: 자동 로그아웃 시간 (분 단위)
- **최대 로그인 시도**: 계정 잠금 전 허용 횟수
- **잠금 지속 시간**: 계정 잠금 해제까지 시간 (분)

#### 🛡️ 비밀번호 정책
- **강력한 비밀번호 요구**: 복잡도 검증 활성화
- **최소 비밀번호 길이**: 6-20자 범위 설정
- **캡차 활성화**: 로봇 공격 방지

#### 📁 파일 업로드 보안
- **허용 파일 형식**: jpg, png, pdf, doc 등
- **최대 파일 크기**: MB 단위 제한
- **속도 제한**: API 요청 제한 (분당 요청 수)

**⚠️ 주의사항**: 보안 설정 변경 시 즉시 적용되므로 신중하게 설정하세요.

---

### 3. 알림 설정 (Notifications Settings)

#### 📧 이메일 서버 설정
- **SMTP 호스트**: 이메일 서버 주소 (예: smtp.gmail.com)
- **SMTP 포트**: 보안 연결 포트 (일반: 587)
- **SMTP 사용자명**: 이메일 계정
- **SMTP 비밀번호**: 앱 비밀번호 (Gmail의 경우)
- **보안 연결**: SSL/TLS 활성화

#### 🔔 알림 유형별 설정
- **이메일 알림**: 전체 이메일 알림 활성화/비활성화
- **주문 알림**: 새 주문, 상태 변경 알림
- **사용자 알림**: 가입, 인증 등 사용자 관련
- **시스템 알림**: 서버 상태, 에러 등 시스템 관련
- **푸시 알림**: 모바일 푸시 알림
- **SMS 알림**: 문자 메시지 알림

#### 📬 발신자 정보
- **발신 이메일**: noreply@youniqle.com
- **발신자 이름**: Youniqle
- **관리자 이메일**: 알림 수신 관리자 목록

**🔧 설정 가이드**: Gmail 사용 시 "앱 비밀번호"를 생성하여 SMTP 비밀번호로 사용하세요.

---

### 4. 결제 설정 (Payment Settings)

#### 💳 결제 수단 관리
- **기본 결제 수단**: 신용카드, 계좌이체, PayPal, 나이스페이
- **결제 게이트웨이 활성화**: 각 수단별 활성화/비활성화

#### 🏦 나이스페이 설정
- **MID (상점 ID)**: 나이스페이에서 발급받은 상점 식별자
- **Secret Key**: API 인증 키
- **에스크로 활성화**: 안전거래 서비스
- **에스크로 수수료**: 거래 금액의 퍼센트

#### 💰 환불 정책
- **환불 기능**: 환불 처리 활성화/비활성화
- **환불 기간**: 구매 후 환불 가능 일수

**💼 비즈니스 연동**: 실제 서비스 운영 시 나이스페이 계약 후 MID와 Secret Key를 발급받아 설정해야 합니다.

---

### 5. 비즈니스 설정 (Business Settings)

#### 🏢 회사 정보
- **회사명**: 그리고바이오
- **사업자등록번호**: 000-00-00000 형식
- **대표자명**: 법정 대표자 이름
- **주소**: 회사 소재지
- **대표 전화번호**: 고객센터 번호
- **이메일**: 공식 연락처

#### 💼 세무 및 배송
- **세율**: 부가가치세율 (기본: 10%)
- **배송비**: 기본 배송비 (원 단위)
- **무료배송 기준**: 무료배송 적용 최소 금액
- **수수료율**: 파트너 수수료율 (기본: 5%)

#### 📋 정책 문서
- **반품/교환 정책**: 고객 안내 정책
- **개인정보 처리방침**: 법적 요구사항
- **서비스 이용약관**: 약관 내용

#### 🤝 파트너 관리
- **파트너 승인 필요**: 수동 승인 여부
- **파트너 자동 승인**: 자동 승인 활성화

**📄 법적 고려사항**: 실제 서비스 시 변호사 검토를 받은 정책 문서로 교체하세요.

---

### 6. SEO 설정 (SEO Settings)

#### 🔍 메타 태그
- **메타 타이틀**: 검색 결과에 표시될 제목 (60자 이내)
- **메타 설명**: 검색 결과 설명 (160자 이내)
- **메타 키워드**: 검색 키워드 (쉼표로 구분)

#### 📊 분석 도구
- **Google Analytics ID**: GA-XXXXXXXXX-X 형식
- **Google Tag Manager ID**: GTM-XXXXXXX 형식
- **Facebook Pixel ID**: 숫자 ID

#### 🤖 검색 엔진 최적화
- **사이트맵 활성화**: XML 사이트맵 자동 생성
- **robots.txt 활성화**: 크롤러 제어 파일
- **정규 URL**: 기본 도메인 설정

**🎯 SEO 효과**: 적절한 메타 태그 설정으로 검색 엔진 노출도를 향상시킬 수 있습니다.

---

### 7. 성능 설정 (Performance Settings)

#### ⚡ 캐싱 및 최적화
- **캐싱 활성화**: 페이지 로딩 속도 향상
- **캐시 지속 시간**: 캐시 유효 시간 (초 단위)
- **이미지 최적화**: 자동 이미지 압축 및 포맷 변환
- **지연 로딩**: 필요 시점에 이미지 로딩
- **압축 활성화**: Gzip 압축으로 전송량 감소

#### 🌐 CDN 설정
- **CDN 활성화**: 콘텐츠 전송 네트워크 사용
- **CDN URL**: CDN 서버 주소
- **최대 동시 요청 수**: 서버 부하 제어

**🚀 성능 개선**: 적절한 캐싱 설정으로 페이지 로딩 속도를 50% 이상 향상시킬 수 있습니다.

---

### 8. 백업 설정 (Backup Settings)

#### 📅 백업 스케줄
- **자동 백업**: 정기적 백업 활성화
- **백업 빈도**: 매일, 매주, 매월 선택
- **백업 보존 기간**: 백업 파일 보관 일수 (7-365일)

#### 💾 백업 대상
- **데이터베이스 백업**: MongoDB 데이터 백업
- **파일 백업**: 업로드된 파일 백업
- **백업 저장 위치**: 서버 내 저장 경로

#### 🔔 백업 알림
- **백업 알림**: 백업 완료/실패 알림
- **수동 백업**: 즉시 백업 실행
- **백업 복원**: 이전 백업으로 복원

**🛡️ 데이터 보호**: 정기적인 백업으로 데이터 손실 위험을 최소화할 수 있습니다.

---

## 📚 이번 채팅 진행 내역

### 🎯 주요 요청사항 및 해결 과정

#### 1. 페이지 레이아웃 통일 작업
**문제점**: 
- 파트너 관리 페이지는 깔끔하게 중앙 정렬됨
- 주문 관리 페이지와 분석 페이지는 레이아웃이 흐트러짐
- 사이드바 중복 표시 문제

**해결 과정**:
1. **파트너 관리 페이지 구조 분석**
   - `AdminLayout` 사용하지 않고 직접 `div` 구조 사용
   - `<div className="space-y-6">` 패턴 확인

2. **주문 관리 페이지 수정**
   - `AdminLayout` 제거하고 직접 `div` 구조로 변경
   - `AdminLayout` import 제거
   - loading 상태에서도 `AdminLayout` 제거

3. **분석 페이지 수정**
   - `AdminLayout` 제거하고 직접 `div` 구조로 변경
   - `AdminLayout` import 제거
   - loading 및 error 상태에서도 `AdminLayout` 제거

**결과**: 모든 관리자 페이지가 파트너 관리 페이지와 동일한 깔끔한 레이아웃으로 통일됨

#### 2. 관리자 분석 페이지 생성
**요청사항**: 사용자 및 파트너 활동을 모니터링하고 분석할 수 있는 시스템

**구현 내용**:
1. **프론트엔드 (`/admin/analytics`)**
   - React 상태 관리 (useState, useEffect)
   - 동적 탭 전환 시스템
   - 실시간 데이터 로딩
   - 에러 처리 및 로딩 상태

2. **백엔드 API (`/api/admin/analytics`)**
   - MongoDB 집계 쿼리
   - 복합 통계 계산
   - 성장률 계산 알고리즘
   - 다중 데이터 소스 통합

3. **분석 항목들**
   - 전체 개요 (사용자, 파트너, 주문, 매출)
   - 사용자 분석 (활성 사용자, 신규 사용자, 세션 시간, 전환율)
   - 파트너 분석 (활성 파트너, 상품 수, 평점, 판매액)
   - 콘텐츠 분석 (조회수, 좋아요, 참여도)
   - 최근 활동 모니터링

#### 3. 관리자 설정 페이지 생성
**요청사항**: 관리자가 설정해야 할 모든 항목들을 포함한 종합 설정 페이지

**구현 내용**:
1. **8개 설정 카테고리**
   - 일반 설정, 보안 설정, 알림 설정
   - 결제 설정, 비즈니스 설정, SEO 설정
   - 성능 설정, 백업 설정

2. **사용자 인터페이스**
   - 탭 기반 인터페이스
   - 실시간 설정 저장
   - 비밀번호 필드 토글
   - 설정 초기화 기능

3. **백엔드 구현**
   - AdminSettings MongoDB 모델
   - 설정 CRUD API (`/api/admin/settings`)
   - 기본값 자동 설정
   - 설정 검증 및 저장

### 🔧 기술적 해결 과정

#### 빌드 에러 수정
**문제**: MongoDB 집계 쿼리에서 `||` 연산자 사용으로 인한 문법 오류
```javascript
// 잘못된 문법
avgSessionTime: { $avg: '$sessionTime' || 0 }

// 올바른 문법
avgSessionTime: { $avg: { $ifNull: ['$sessionTime', 0] } }
```

**해결**: `$ifNull` 연산자를 사용하여 null 값 처리

#### 레이아웃 구조 변경
**이전 구조**:
```tsx
<AdminLayout>
  <div className="w-full space-y-6">
    {/* 페이지 내용 */}
  </div>
</AdminLayout>
```

**수정 후 구조**:
```tsx
<div className="space-y-6">
  {/* 페이지 내용 */}
</div>
```

---

## 🛠️ 기술적 구현 사항

### 프론트엔드 기술 스택
- **React**: 함수형 컴포넌트, Hooks
- **TypeScript**: 타입 안전성 보장
- **Tailwind CSS**: 반응형 디자인
- **shadcn/ui**: UI 컴포넌트 라이브러리
- **Radix UI**: 접근성 고려 컴포넌트

### 백엔드 기술 스택
- **Next.js API Routes**: 서버사이드 API
- **MongoDB**: 데이터 저장소
- **Mongoose**: ODM (Object Document Mapping)
- **JWT**: 인증 토큰 관리

### 데이터베이스 스키마
```javascript
// AdminSettings 모델 구조
{
  general: { siteName, siteDescription, defaultLanguage, ... },
  security: { enableTwoFactor, sessionTimeout, maxLoginAttempts, ... },
  notifications: { emailNotifications, smtpHost, smtpPort, ... },
  payment: { defaultPaymentMethod, enableNicepay, nicepayMid, ... },
  business: { companyName, businessNumber, ceoName, ... },
  seo: { metaTitle, metaDescription, googleAnalyticsId, ... },
  performance: { enableCaching, cacheDuration, enableCdn, ... },
  backup: { enableAutoBackup, backupFrequency, backupRetention, ... }
}
```

### API 엔드포인트
- `GET /api/admin/analytics` - 분석 데이터 조회
- `GET /api/admin/settings` - 설정 조회
- `PUT /api/admin/settings` - 설정 업데이트
- `DELETE /api/admin/settings` - 설정 초기화

---

## 📖 사용법 및 주의사항

### 🔐 접근 권한
- 관리자 계정으로만 접근 가능
- 허용된 이메일: `admin@youniqle.com`, `grigobio237@gmail.com`
- 세션 타임아웃 시 재로그인 필요

### ⚠️ 설정 변경 시 주의사항

#### 보안 설정
- 2단계 인증 활성화 시 기존 세션 무효화
- 비밀번호 정책 변경 시 다음 로그인부터 적용
- 세션 타임아웃 변경 시 즉시 적용

#### 알림 설정
- SMTP 설정 변경 후 이메일 발송 테스트 권장
- 잘못된 SMTP 정보로 인한 알림 실패 가능성

#### 결제 설정
- 나이스페이 MID/Secret Key는 실제 계약 후 발급
- 잘못된 결제 정보로 인한 결제 실패 가능성

#### 성능 설정
- 캐시 설정 변경 시 기존 캐시 클리어 필요
- CDN 설정 변경 시 DNS 전파 시간 고려

### 🔄 백업 및 복원
- 정기적인 설정 백업 권장
- 설정 변경 전 현재 설정 스크린샷 저장
- 문제 발생 시 설정 초기화 기능 활용

### 📱 모바일 지원
- 모든 설정 페이지 모바일 최적화 완료
- 터치 인터페이스 지원
- 반응형 그리드 레이아웃

---

## 🎉 완성된 기능 요약

### ✅ 페이지 레이아웃 통일
- 모든 관리자 페이지가 일관된 레이아웃 사용
- 사이드바 중복 문제 해결
- 모바일 반응형 최적화

### ✅ 종합 분석 시스템
- 사용자/파트너 활동 실시간 모니터링
- 성장률 및 통계 분석
- 상위 사용자/파트너 랭킹

### ✅ 완전한 설정 관리 시스템
- 8개 카테고리 80+ 설정 항목
- 실시간 저장 및 초기화 기능
- 보안 및 성능 최적화 설정

### 📊 최종 빌드 결과
- **컴파일 성공**: 모든 페이지 정상 빌드
- **페이지 수**: 99개 페이지 생성
- **새 페이지**: 분석 (5.84 kB), 설정 (10.6 kB)
- **API 엔드포인트**: 45개+ API 구현

---

## 📞 지원 및 문의

### 기술 지원
- 빌드 오류 시 `npm run build` 실행하여 확인
- 설정 저장 실패 시 브라우저 개발자 도구 콘솔 확인
- 데이터베이스 연결 문제 시 MongoDB Atlas 상태 확인

### 추가 개발 필요사항
- 설정 변경 이력 추적 시스템
- 설정 백업/복원 자동화
- 설정 변경 알림 시스템
- 설정 검증 및 자동 수정 기능

---

*이 문서는 2024년 12월 28일 기준으로 작성되었으며, 시스템 업데이트 시 함께 갱신되어야 합니다.*
